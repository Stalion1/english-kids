<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>English Kids</title>

<style>
:root{
  --blue:#4a6cf7;
  --pink:#ff4fa3;
  --yellow:#ffd54a;
  --mint:#2dd4bf;
  --bg1:#ffecd2;
  --bg2:#fcb69f;
  --card:#ffffffee;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, "Arial Rounded MT Bold", Arial, sans-serif;
  background: linear-gradient(135deg,var(--bg1),var(--bg2));
  color:#223;
  text-align:center;
}

/* Header + star meter */
header{
  position: sticky;
  top: 0;
  z-index: 5;
  background: linear-gradient(90deg,var(--blue),#7b5cff);
  color:#fff;
  padding:12px 12px;
  font-size:20px;
  font-weight:900;
  box-shadow:0 6px 16px rgba(0,0,0,.25);
}
.header-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  max-width:560px;
  margin:0 auto;
}
.app-title{display:flex; align-items:center; gap:8px;}
.star-meter{
  display:flex;
  align-items:center;
  gap:8px;
  background: rgba(255,255,255,.18);
  border: 2px solid rgba(255,255,255,.25);
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 16px;
  font-weight: 1000;
  backdrop-filter: blur(6px);
}
.star-meter .big{font-size:18px;}
.star-meter button{
  padding:8px 10px;
  font-size:14px;
  border-radius: 999px;
  box-shadow:none;
}
.star-meter button:active{transform:scale(.98);}

section{
  max-width:520px;
  margin:0 auto;
  padding:18px;
}

.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  margin-bottom:18px;
  box-shadow:0 10px 24px rgba(0,0,0,.15);
}

h2{
  margin:0 0 10px;
  font-size:20px;
}

img{
  width:220px;
  height:220px;
  border-radius:16px;
  background:#fff;
  box-shadow:0 10px 20px rgba(0,0,0,.15);
}

.word{
  font-size:34px;
  font-weight:1000;
  letter-spacing:2px;
  margin:10px 0;
}
.hidden{
  letter-spacing:6px;
}

.row{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
}

button{
  border:none;
  border-radius:16px;
  padding:14px 18px;
  font-size:18px;
  font-weight:900;
  cursor:pointer;
  box-shadow:0 8px 16px rgba(0,0,0,.18);
  -webkit-tap-highlight-color: transparent;
}
button:active{transform:scale(.97);}

.btn-blue{background:linear-gradient(135deg,var(--blue),#7b5cff);color:#fff}
.btn-pink{background:linear-gradient(135deg,var(--pink),#ff85c8);color:#fff}
.btn-yellow{background:linear-gradient(135deg,var(--yellow),#ffe98a);color:#5a3b00}
.btn-mint{background:linear-gradient(135deg,var(--mint),#7ff3e7);color:#064}

/* Drawing canvas */
#draw{
  width:320px;
  height:210px;
  background:#fff;
  border-radius:16px;
  border:3px solid #00000010;
  touch-action:none;
  box-shadow: inset 0 0 0 2px #4a6cf720;
}

/* Floating star reward animation */
#fx-layer{
  position:fixed;
  inset:0;
  pointer-events:none;
  z-index: 9999;
}

.fx-star{
  position:absolute;
  font-size: 32px;
  font-weight: 1000;
  filter: drop-shadow(0 10px 10px rgba(0,0,0,.18));
  animation: floatUp .9s ease-out forwards;
}
@keyframes floatUp{
  0%   { transform: translate(-50%, -50%) scale(.7) rotate(-8deg); opacity:0; }
  20%  { opacity:1; }
  60%  { transform: translate(-50%, -90px) scale(1.1) rotate(6deg); }
  100% { transform: translate(-50%, -140px) scale(.9) rotate(0deg); opacity:0; }
}

/* Tiny pop for header star count */
.pop{
  animation: pop .22s ease-out;
}
@keyframes pop{
  0%{transform:scale(1)}
  60%{transform:scale(1.18)}
  100%{transform:scale(1)}
}
.small-note{
  font-size:13px;
  opacity:.78;
  font-weight:700;
  margin-top:8px;
}
</style>
</head>

<body>

<header>
  <div class="header-row">
    <div class="app-title">üåà English Kids</div>
    <div class="star-meter" aria-label="Stars earned">
      <span class="big">‚≠ê</span>
      <span id="starCount">0</span>
      <button class="btn-yellow" id="resetStarsBtn" title="Reset stars">Reset</button>
    </div>
  </div>
</header>

<div id="fx-layer"></div>

<section>

  <div class="card">
    <h2>üëÄ Look</h2>
    <img id="pic" src="https://placehold.co/220x220?text=DOG" alt="Dog">
    <div class="small-note">Tip: tap ‚ÄúRandom‚Äù to change the picture!</div>
  </div>

  <div class="card">
    <h2>ü§î Guess</h2>
    <div id="word" class="word hidden">‚Ä¢‚Ä¢‚Ä¢</div>
    <div class="row">
      <button class="btn-yellow" id="revealBtn">Reveal ‚≠ê</button>
      <button class="btn-mint" id="randomBtn">Random üé≤</button>
    </div>
  </div>

  <div class="card">
    <h2>üó£Ô∏è Say</h2>
    <div class="row">
      <button class="btn-blue" id="sayBtn">Say it üîä</button>
    </div>
  </div>

  <div class="card">
    <h2>‚úçÔ∏è Write</h2>
    <canvas id="draw"></canvas><br><br>
    <button class="btn-pink" id="clearBtn">Clear ‚ú®</button>
    <div class="small-note">Draw the word‚Äôs first letter!</div>
  </div>

</section>

<script>
/* ---------------------------
   Lessons
--------------------------- */
const lessons = [
  { word:"DOG",  say:"dog",  img:"https://placehold.co/220x220?text=DOG"  },
  { word:"CAT",  say:"cat",  img:"https://placehold.co/220x220?text=CAT"  },
  { word:"BALL", say:"ball", img:"https://placehold.co/220x220?text=BALL" },
  { word:"BOOK", say:"book", img:"https://placehold.co/220x220?text=BOOK" }
];

let i = 0;
let shown = false;

const pic = document.getElementById("pic");
const wordEl = document.getElementById("word");

/* ---------------------------
   Stars (saved on device)
--------------------------- */
const STAR_KEY = "englishkids_stars_v1";
let stars = Number(localStorage.getItem(STAR_KEY) || "0");

const starCountEl = document.getElementById("starCount");
const starMeterEl = document.querySelector(".star-meter");
function renderStars(){
  starCountEl.textContent = String(stars);
}
renderStars();

function addStars(n=1, x=null, y=null){
  stars += n;
  localStorage.setItem(STAR_KEY, String(stars));
  renderStars();
  // little header pop
  starMeterEl.classList.remove("pop");
  void starMeterEl.offsetWidth;
  starMeterEl.classList.add("pop");
  // star FX
  if (x != null && y != null) spawnStarFX(x, y, n);
  // reward chime
  rewardChime();
}

document.getElementById("resetStarsBtn").addEventListener("click", (e)=>{
  // keep it simple: one-tap reset
  stars = 0;
  localStorage.setItem(STAR_KEY, "0");
  renderStars();
  clickSound(450);
});

/* ---------------------------
   Render
--------------------------- */
function render(){
  const L = lessons[i];
  pic.src = L.img;
  pic.alt = L.word;
  wordEl.textContent = shown ? L.word : "‚Ä¢‚Ä¢‚Ä¢";
}
render();

/* ---------------------------
   Sound effects (WebAudio)
   (User interaction required to start on iOS)
--------------------------- */
let audioCtx = null;
function ensureAudio(){
  if (!audioCtx){
    const AC = window.AudioContext || window.webkitAudioContext;
    audioCtx = new AC();
  }
  if (audioCtx.state === "suspended") audioCtx.resume();
}
function tone(freq, duration=0.12, gain=0.12, type="sine"){
  ensureAudio();
  const o = audioCtx.createOscillator();
  const g = audioCtx.createGain();
  o.type = type;
  o.frequency.value = freq;
  o.connect(g);
  g.connect(audioCtx.destination);
  g.gain.value = 0.0001;
  g.gain.exponentialRampToValueAtTime(gain, audioCtx.currentTime + 0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
  o.start();
  o.stop(audioCtx.currentTime + duration + 0.02);
}
function clickSound(freq=600){
  tone(freq, 0.09, 0.10, "triangle");
}
function rewardChime(){
  // a quick happy two-tone chime
  tone(880, 0.10, 0.12, "sine");
  setTimeout(()=>tone(1175, 0.12, 0.10, "sine"), 70);
}

/* ---------------------------
   Floating star FX
--------------------------- */
const fxLayer = document.getElementById("fx-layer");
function spawnStarFX(x, y, count=1){
  const n = Math.min(3, Math.max(1, count));
  for(let k=0;k<n;k++){
    const s = document.createElement("div");
    s.className = "fx-star";
    s.textContent = "‚≠ê";
    const jitterX = (Math.random()*28 - 14);
    const jitterY = (Math.random()*18 - 9);
    s.style.left = (x + jitterX) + "px";
    s.style.top  = (y + jitterY) + "px";
    fxLayer.appendChild(s);
    setTimeout(()=>s.remove(), 950);
  }
}

/* helper: get center of a button for FX */
function centerOf(el){
  const r = el.getBoundingClientRect();
  return { x: r.left + r.width/2, y: r.top + r.height/2 };
}

/* ---------------------------
   Buttons
--------------------------- */
const revealBtn = document.getElementById("revealBtn");
const randomBtn = document.getElementById("randomBtn");
const sayBtn    = document.getElementById("sayBtn");
const clearBtn  = document.getElementById("clearBtn");

revealBtn.addEventListener("click", ()=>{
  clickSound(700);
  shown = true;
  render();
  const c = centerOf(revealBtn);
  addStars(2, c.x, c.y); // bigger reward
});

randomBtn.addEventListener("click", ()=>{
  clickSound(520);
  i = Math.floor(Math.random() * lessons.length);
  shown = false;
  render();
  const c = centerOf(randomBtn);
  addStars(1, c.x, c.y);
});

sayBtn.addEventListener("click", ()=>{
  clickSound(640);
  const msg = new SpeechSynthesisUtterance(lessons[i].say);
  msg.rate = 0.82;
  speechSynthesis.cancel();
  speechSynthesis.speak(msg);
  const c = centerOf(sayBtn);
  addStars(1, c.x, c.y);
});

/* ---------------------------
   Drawing (better feel + reward on first stroke)
--------------------------- */
const canvas = document.getElementById("draw");
const ctx = canvas.getContext("2d");

// Make canvas crisp on phones
function fitCanvas(){
  const dpr = Math.max(1, window.devicePixelRatio || 1);
  const rect = canvas.getBoundingClientRect();
  canvas.width  = Math.round(rect.width  * dpr);
  canvas.height = Math.round(rect.height * dpr);
  ctx.setTransform(dpr,0,0,dpr,0,0);
  ctx.lineWidth = 7;
  ctx.lineCap = "round";
  ctx.lineJoin = "round";
}
fitCanvas();
window.addEventListener("resize", fitCanvas);

let drawing = false;
let earnedForThisDraw = false;

function pos(e){
  const r = canvas.getBoundingClientRect();
  return { x: e.clientX - r.left, y: e.clientY - r.top };
}

canvas.addEventListener("pointerdown", (e)=>{
  ensureAudio();
  drawing = true;
  const p = pos(e);
  ctx.beginPath();
  ctx.moveTo(p.x, p.y);
  canvas.setPointerCapture(e.pointerId);

  if (!earnedForThisDraw){
    const r = canvas.getBoundingClientRect();
    addStars(1, r.left + r.width/2, r.top + 30);
    earnedForThisDraw = true;
  }
});

canvas.addEventListener("pointermove", (e)=>{
  if(!drawing) return;
  const p = pos(e);
  ctx.lineTo(p.x, p.y);
  ctx.stroke();
});

function endDraw(e){
  drawing = false;
  try{ canvas.releasePointerCapture(e.pointerId); }catch{}
}
canvas.addEventListener("pointerup", endDraw);
canvas.addEventListener("pointercancel", endDraw);
canvas.addEventListener("pointerleave", ()=>drawing=false);

clearBtn.addEventListener("click", ()=>{
  clickSound(480);
  const rect = canvas.getBoundingClientRect();
  ctx.clearRect(0,0,rect.width,rect.height);
  earnedForThisDraw = false;
  // small reward for clearing to try again
  addStars(1, rect.left + rect.width/2, rect.top +
